<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
  <parent>
    <artifactId>sqoop</artifactId>
    <groupId>com.stratio.sqoop</groupId>
    <version>0.1.0-RC2-SNAPSHOT</version>
  </parent>
  <modelVersion>4.0.0</modelVersion>
  <groupId>org.apache.sqoop</groupId>
  <artifactId>sqoop-server</artifactId>
  <name>Sqoop Server</name>
  <profiles>
    <profile>
      <id>package</id>
      <build>
        <plugins>
          <plugin>
            <groupId>org.codehaus.mojo</groupId>
            <artifactId>appassembler-maven-plugin</artifactId>
            <version>1.10</version>
            <executions>
              <execution>
                <phase>package</phase>
                <goals>
                  <goal>assemble</goal>
                </goals>
                <configuration>
                  <platforms>
                    <platform>unix</platform>
                  </platforms>
                  <configurationDirectory>config</configurationDirectory>
                  <copyConfigurationDirectory>true</copyConfigurationDirectory>
                  <includeConfigurationDirectoryInClasspath>true</includeConfigurationDirectoryInClasspath>
                  <assembleDirectory>target/appassembler</assembleDirectory>
                  <extraJvmArguments>-Dsqoop.config.dir=/etc/sds/sqoop-server $SQOOP_OPTS</extraJvmArguments>
                  <programs>
                    <program>
                      <mainClass>org.apache.sqoop.server.SqoopJettyServer</mainClass>
                      <name>server</name>
                    </program>
                  </programs>
                </configuration>
              </execution>
            </executions>
            <configuration>
              <platforms>
                <platform>unix</platform>
              </platforms>
              <configurationDirectory>config</configurationDirectory>
              <copyConfigurationDirectory>true</copyConfigurationDirectory>
              <includeConfigurationDirectoryInClasspath>true</includeConfigurationDirectoryInClasspath>
              <assembleDirectory>target/appassembler</assembleDirectory>
              <extraJvmArguments>-Dsqoop.config.dir=/etc/sds/sqoop-server $SQOOP_OPTS</extraJvmArguments>
              <programs>
                <program>
                  <mainClass>org.apache.sqoop.server.SqoopJettyServer</mainClass>
                  <name>server</name>
                </program>
              </programs>
            </configuration>
          </plugin>
          <plugin>
            <artifactId>maven-shade-plugin</artifactId>
            <version>2.3</version>
            <executions>
              <execution>
                <phase>package</phase>
                <goals>
                  <goal>shade</goal>
                </goals>
                <configuration>
                  <filters>
                    <filter>
                      <artifact>*:*</artifact>
                      <excludes>
                        <exclude>META-INF/*.SF</exclude>
                        <exclude>META-INF/*.DSA</exclude>
                        <exclude>META-INF/*.RSA</exclude>
                      </excludes>
                    </filter>
                  </filters>
                  <artifactSet>
                    <excludes>
                      <exclude>classworlds:classworlds</exclude>
                      <exclude>junit:junit</exclude>
                      <exclude>jmock:*</exclude>
                      <exclude>*:xml-apis</exclude>
                      <exclude>org.apache.maven:lib:tests</exclude>
                    </excludes>
                  </artifactSet>
                  <transformers>
                    <transformer />
                    <transformer>
                      <resource>spark-defaults.conf</resource>
                    </transformer>
                  </transformers>
                </configuration>
              </execution>
            </executions>
          </plugin>
          <plugin>
            <groupId>com.stratio.mojo.unix</groupId>
            <artifactId>unix-maven-plugin</artifactId>
            <version>1.1.6</version>
            <extensions>true</extensions>
            <executions>
              <execution>
                <id>deb</id>
                <phase>package</phase>
                <goals>
                  <goal>package-deb</goal>
                </goals>
                <configuration>
                  <architecture>all</architecture>
                  <assembly>
                    <copyFile>
                      <path>src/main/unix/files_and_dirs/etc/init.d/sqoop-server</path>
                      <toFile>/etc/init.d/sqoop-server</toFile>
                      <attributes>
                        <user>root</user>
                        <group>root</group>
                        <mode>755</mode>
                      </attributes>
                    </copyFile>
                    <copyFile>
                      <path>src/main/unix/files_and_dirs/etc/default/sqoop-server-variables</path>
                      <toFile>/etc/default/sqoop-server-variables</toFile>
                      <attributes>
                        <user>root</user>
                        <group>root</group>
                        <mode>755</mode>
                      </attributes>
                    </copyFile>
                    <mkdirs>
                      <path>/opt/sds/sqoop-server</path>
                      <attributes>
                        <user>sqoop</user>
                        <group>stratio</group>
                      </attributes>
                    </mkdirs>
                    <mkdirs>
                      <path>/var/run/sds</path>
                      <attributes>
                        <user>sqoop</user>
                        <group>stratio</group>
                      </attributes>
                    </mkdirs>
                    <mkdirs>
                      <path>/var/log/sds/sqoop-server</path>
                      <attributes>
                        <user>sqoop</user>
                        <group>stratio</group>
                      </attributes>
                    </mkdirs>
                    <mkdirs>
                      <path>/opt/sds/.m2</path>
                      <attributes>
                        <user>sqoop</user>
                        <group>stratio</group>
                      </attributes>
                    </mkdirs>
                    <copyDirectory>
                      <from>target/appassembler/bin</from>
                      <to>/opt/sds/sqoop-server/bin</to>
                    </copyDirectory>
                    <copyDirectory>
                      <from>target/appassembler/repo</from>
                      <to>/opt/sds/sqoop-server/repo</to>
                    </copyDirectory>
                    <copyDirectory>
                      <from>target/appassembler/config/</from>
                      <to>/etc/sds/sqoop-server/</to>
                      <directoryAttributes>
                        <user>sqoop</user>
                        <group>stratio</group>
                      </directoryAttributes>
                    </copyDirectory>
                  </assembly>
                  <outputFileName>stratio-sqoop-server</outputFileName>
                  <contact>Stratio Sqoop&lt;sqoop@stratio.com&gt;</contact>
                  <contactEmail>sqoop@stratio.com</contactEmail>
                  <deb>
                    <section>devel</section>
                  </deb>
                  <rpm>
                    <group>stratio</group>
                    <requires>bash</requires>
                  </rpm>
                  <name>Sqoop Shell</name>
                  <excludeDirectoryAttributes>
                    <dir>/etc</dir>
                    <dir>/etc/init.d</dir>
                    <dir>/etc/default</dir>
                    <dir>/var</dir>
                    <dir>/opt</dir>
                    <dir>/usr</dir>
                    <dir>/bin</dir>
                  </excludeDirectoryAttributes>
                  <defaults>
                    <directoryAttributes>
                      <user>sqoop</user>
                      <group>stratio</group>
                      <mode>0750</mode>
                    </directoryAttributes>
                    <fileAttributes>
                      <user>sqoop</user>
                      <group>stratio</group>
                      <mode>0644</mode>
                    </fileAttributes>
                  </defaults>
                </configuration>
              </execution>
              <execution>
                <id>rpm</id>
                <phase>package</phase>
                <goals>
                  <goal>package-rpm</goal>
                </goals>
                <configuration>
                  <architecture>noarch</architecture>
                  <assembly>
                    <copyFile>
                      <path>src/main/unix/files_and_dirs/etc/init.d/sqoop-server</path>
                      <toFile>/etc/init.d/sqoop-server</toFile>
                      <attributes>
                        <user>root</user>
                        <group>root</group>
                        <mode>755</mode>
                      </attributes>
                    </copyFile>
                    <copyFile>
                      <path>src/main/unix/files_and_dirs/etc/default/sqoop-server-variables</path>
                      <toFile>/etc/default/sqoop-server-variables</toFile>
                      <attributes>
                        <user>root</user>
                        <group>root</group>
                        <mode>755</mode>
                      </attributes>
                    </copyFile>
                    <mkdirs>
                      <path>/opt/sds/sqoop-server</path>
                      <attributes>
                        <user>sqoop</user>
                        <group>stratio</group>
                      </attributes>
                    </mkdirs>
                    <mkdirs>
                      <path>/var/run/sds</path>
                      <attributes>
                        <user>sqoop</user>
                        <group>stratio</group>
                      </attributes>
                    </mkdirs>
                    <mkdirs>
                      <path>/var/log/sds/sqoop-server</path>
                      <attributes>
                        <user>sqoop</user>
                        <group>stratio</group>
                      </attributes>
                    </mkdirs>
                    <mkdirs>
                      <path>/opt/sds/.m2</path>
                      <attributes>
                        <user>sqoop</user>
                        <group>stratio</group>
                      </attributes>
                    </mkdirs>
                    <copyDirectory>
                      <from>target/appassembler/bin</from>
                      <to>/opt/sds/sqoop-server/bin</to>
                    </copyDirectory>
                    <copyDirectory>
                      <from>target/appassembler/repo</from>
                      <to>/opt/sds/sqoop-server/repo</to>
                    </copyDirectory>
                    <copyDirectory>
                      <from>target/appassembler/config/</from>
                      <to>/etc/sds/sqoop-server/</to>
                      <directoryAttributes>
                        <user>sqoop</user>
                        <group>stratio</group>
                      </directoryAttributes>
                    </copyDirectory>
                  </assembly>
                  <outputFileName>stratio-sqoop-server</outputFileName>
                  <contact>Stratio Sqoop&lt;sqoop@stratio.com&gt;</contact>
                  <contactEmail>sqoop@stratio.com</contactEmail>
                  <deb>
                    <section>devel</section>
                  </deb>
                  <rpm>
                    <group>stratio</group>
                    <requires>bash</requires>
                  </rpm>
                  <name>Sqoop Shell</name>
                  <excludeDirectoryAttributes>
                    <dir>/etc</dir>
                    <dir>/etc/init.d</dir>
                    <dir>/etc/default</dir>
                    <dir>/var</dir>
                    <dir>/opt</dir>
                    <dir>/usr</dir>
                    <dir>/bin</dir>
                  </excludeDirectoryAttributes>
                  <defaults>
                    <directoryAttributes>
                      <user>sqoop</user>
                      <group>stratio</group>
                      <mode>0750</mode>
                    </directoryAttributes>
                    <fileAttributes>
                      <user>sqoop</user>
                      <group>stratio</group>
                      <mode>0644</mode>
                    </fileAttributes>
                  </defaults>
                </configuration>
              </execution>
            </executions>
            <inherited>false</inherited>
            <configuration>
              <outputFileName>stratio-sqoop-server</outputFileName>
              <contact>Stratio Sqoop&lt;sqoop@stratio.com&gt;</contact>
              <contactEmail>sqoop@stratio.com</contactEmail>
              <deb>
                <section>devel</section>
              </deb>
              <rpm>
                <group>stratio</group>
                <requires>bash</requires>
              </rpm>
              <name>Sqoop Shell</name>
              <excludeDirectoryAttributes>
                <dir>/etc</dir>
                <dir>/etc/init.d</dir>
                <dir>/etc/default</dir>
                <dir>/var</dir>
                <dir>/opt</dir>
                <dir>/usr</dir>
                <dir>/bin</dir>
              </excludeDirectoryAttributes>
              <defaults>
                <directoryAttributes>
                  <user>sqoop</user>
                  <group>stratio</group>
                  <mode>0750</mode>
                </directoryAttributes>
                <fileAttributes>
                  <user>sqoop</user>
                  <group>stratio</group>
                  <mode>0644</mode>
                </fileAttributes>
              </defaults>
              <assembly>
                <mkdirs>
                  <path>/opt/sds/sqoop-server</path>
                  <attributes>
                    <user>sqoop</user>
                    <group>stratio</group>
                  </attributes>
                </mkdirs>
                <mkdirs>
                  <path>/var/run/sds</path>
                  <attributes>
                    <user>sqoop</user>
                    <group>stratio</group>
                  </attributes>
                </mkdirs>
                <mkdirs>
                  <path>/var/log/sds/sqoop-server</path>
                  <attributes>
                    <user>sqoop</user>
                    <group>stratio</group>
                  </attributes>
                </mkdirs>
                <mkdirs>
                  <path>/opt/sds/.m2</path>
                  <attributes>
                    <user>sqoop</user>
                    <group>stratio</group>
                  </attributes>
                </mkdirs>
                <copyDirectory>
                  <from>target/appassembler/bin</from>
                  <to>/opt/sds/sqoop-server/bin</to>
                </copyDirectory>
                <copyDirectory>
                  <from>target/appassembler/repo</from>
                  <to>/opt/sds/sqoop-server/repo</to>
                </copyDirectory>
                <copyDirectory>
                  <from>target/appassembler/config/</from>
                  <to>/etc/sds/sqoop-server/</to>
                  <directoryAttributes>
                    <user>sqoop</user>
                    <group>stratio</group>
                  </directoryAttributes>
                </copyDirectory>
                <copyFile>
                  <path>target/sqoop-server-0.1.0-RC2-SNAPSHOT.jar</path>
                  <toFile>/opt/sds/sqoop-server/repo/sqoop-server-0.1.0-RC2-SNAPSHOT.jar</toFile>
                </copyFile>
              </assembly>
            </configuration>
          </plugin>
        </plugins>
      </build>
    </profile>
  </profiles>
  <dependencies>
    <dependency>
      <groupId>javax.servlet</groupId>
      <artifactId>servlet-api</artifactId>
      <version>2.5</version>
      <scope>provided</scope>
    </dependency>
    <dependency>
      <groupId>org.testng</groupId>
      <artifactId>testng</artifactId>
      <version>6.8.17</version>
      <scope>test</scope>
      <exclusions>
        <exclusion>
          <artifactId>bsh</artifactId>
          <groupId>org.beanshell</groupId>
        </exclusion>
      </exclusions>
    </dependency>
    <dependency>
      <groupId>net.sourceforge.findbugs</groupId>
      <artifactId>annotations</artifactId>
      <version>1.3.2</version>
      <scope>provided</scope>
    </dependency>
  </dependencies>
</project>

